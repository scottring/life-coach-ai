<!DOCTYPE html>
<html>
<head>
    <title>Gmail API Test</title>
</head>
<body>
    <h1>Gmail API Test</h1>
    <button id="authorize">Authorize Gmail</button>
    <button id="test" style="display:none;">Test Gmail API</button>
    <pre id="result"></pre>

    <script>
        const CLIENT_ID = '77559771257-fl16uhd249dgjrle0llgqch64p4uovq0.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/gmail.readonly https://www.googleapis.com/auth/userinfo.email';
        
        let accessToken = null;

        document.getElementById('authorize').addEventListener('click', () => {
            const client = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: (response) => {
                    if (response.access_token) {
                        accessToken = response.access_token;
                        document.getElementById('test').style.display = 'inline';
                        document.getElementById('result').textContent = 'Authorization successful! Token received.';
                    }
                },
            });
            client.requestAccessToken();
        });

        document.getElementById('test').addEventListener('click', async () => {
            if (!accessToken) {
                alert('Please authorize first');
                return;
            }

            try {
                // Test Gmail API
                const response = await fetch('https://gmail.googleapis.com/gmail/v1/users/me/messages?maxResults=1', {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });

                const data = await response.json();
                document.getElementById('result').textContent = JSON.stringify({
                    status: response.status,
                    statusText: response.statusText,
                    data: data
                }, null, 2);
            } catch (error) {
                document.getElementById('result').textContent = 'Error: ' + error.message;
            }
        });
    </script>
    <script src="https://accounts.google.com/gsi/client"></script>
</body>
</html>